<!DOCTYPE html>
<html>
<head>
    <title>Test Synchronous Logout</title>
</head>
<body>
    <h1>Testing Synchronous Logout</h1>
    <button onclick="testLogout()">Test Logout Function</button>
    <div id="log"></div>

    <script>
        function log(message) {
            document.getElementById('log').innerHTML += '<div>' + new Date().toISOString() + ': ' + message + '</div>';
        }

        function testLogout() {
            log('ðŸ”´ SYNCHRONOUS LOGOUT START');
            
            // Clear storage synchronously
            localStorage.clear();
            sessionStorage.clear();
            log('ðŸ”´ STORAGE CLEARED');
            
            // Synchronous server logout using XMLHttpRequest
            try {
                const xhr = new XMLHttpRequest();
                xhr.open('POST', '/api/logout', false); // false = synchronous
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.send();
                log('ðŸ”´ SYNCHRONOUS SERVER LOGOUT COMPLETE: ' + xhr.status);
            } catch (e) {
                log('ðŸ”´ SERVER LOGOUT ERROR (IGNORED): ' + e);
            }
            
            log('ðŸ”´ ABOUT TO REDIRECT TO LOGIN');
            // Don't actually redirect in test
            // window.location.href = "/login";
            log('ðŸ”´ REDIRECT COMMAND WOULD EXECUTE HERE');
            log('âœ… LOGOUT FUNCTION COMPLETED SYNCHRONOUSLY');
        }
    </script>
</body>
</html>